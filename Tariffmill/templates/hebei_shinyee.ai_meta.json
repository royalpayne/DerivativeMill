{
  "provider": "Anthropic",
  "model": "claude-sonnet-4-20250514",
  "template_name": "hebei_shinyee",
  "supplier_name": "Hebei Shinyee Trade Co",
  "country": "CHINA",
  "client": "Sigma Corportation",
  "invoice_text": "Issuer\nHEBEI SHINYEE TRADE CO.,LTD\nROOM A 2006, HUAHAI UNIVERSAL PLAZA\n\u5546 \u4e1a \u53d1 \u7968\nNO.199 XINHUA ROAD,SHIJIAZHUANG\nHEBEI CHINA COMMERCIAL INVOICE\nTo\nSIGMA CORP.\n700 GOLDMAN DRIVE No. Date\nCREAM RIDGE,NJ 08514 SH25-3081 05/Nov/2025\nS/C No. L/C No.\nSH25-3081\nTransport details Terms of payment\nSHIPMENT FROM XINGANG BY T/T AT SIGHT\nTO CHICAGO BY SEA FOB XINGANG\nMarks and numbers Number and kind of package; description of goods QuantitUynit priceA mount\nAlsip, IL CAST IRON PUMP COMPONENTS\n11/7/2025 ITEM# USD/PC PCS FOB\n26-ISN15852 21.33 60 USD 1279.80\n26-ISN452 4.83 600 USD 2898.00\n26-ISN598 13.46 128 USD 1722.88\n26-ISN604 14.94 224 USD 3346.56\n26-ISNC1861 10.63 200 USD 2126.00\n26-ISNC2866 9.34 270 USD 2521.80\n26-ISNC76-67E 21.11 672 USD 14185.92\n26-ISNC76-68E 24.69 192 USD 4740.48\n26-ISNM16045 21.11 54 USD 1139.94\n26-ISNM16389 28.48 60 USD 1708.80\n26-ISNM16568 26.29 45 USD 1183.05\n26-ISNN76-44G 28.33 360 USD 10198.80\n32-IBRP7163 10.57 150 USD 1585.50\n33-28132B000 21.87 500 USD 10935.00\n33-28136D000 6.57 360 USD 2365.20\n33-IMY408 4.29 252 USD 1081.08\n33-IMY571D200 15.15 108 USD 1636.20\n33-IMY574 8.74 200 USD 1748.00\n33-IMY578 6.54 150 USD 981.00\n33-IMY7195 21.84 144 USD 3144.96\n33-IMY790 14.38 125 USD 1797.50\n33-IMYF4434 26.67 128 USD 3413.76\n33-IMYF4436 38.41 72 USD 2765.52\n39-IVACD20122 15.01 100 USD 1501.00\nCMM COST FOR 33-28132B000 30.00 20 USD 600.00\nCMM COST FOR 33-28136D000 35.00 15 USD 525.00\nTOTAL1: USD 81131.75\nINTEREST: USD 973.58\nTOTAL2: USD 82105.33\nTOTAL : 45CRATES\nG. W.: 34400.00KGS\nN. W.: 32400.00KGS\nCOUNTRY OF ORIGIN:CHINA\nSHIPMENT CONTAINS PROPERLY\nTREATED WOOD PACKING MATERIAL.\n\nIssuer\nHEBEI SHINYEE TRADE CO.,LTD\nROOM A 2006, HUAHAI UNIVERSAL PLAZA\nNO.199 XINHUA ROAD,SHIJIAZHUANG\n\u88c5 \u7bb1 \u5355\nHEBEI CHINA\nPACKING LIST\nTo\nSIGMA CORP.\n700 GOLDMAN DRIVE\nCREAM RIDGE,NJ 08514\nInvoice No. Date\nSH25-3081 05/Nov/2025\nMarks and numbers Number and kind of package; description of goods\nAlsip, IL CAST IRON PUMP COMPONENTS\n11/7/2025\nCSLU1886832 ITEM# CRATE PCS/C PCS\n1-5# 26-ISNN76-44G 5 72 360\n6# 26-ISNC76-67E 1 96 96\n7-9# 26-ISNC76-68E 3 64 192\n10-15# 26-ISNC76-67E 6 96 576\n16# 33-IMY578 1 150 150\n17-18# 33-IMY7195 2 72 144\n19-20# 33-IMYF4434 2 64 128\nDFSU2678460\n1-4# 33-28132B000 4 100 400\n5# 33-28132B000 1 100 100\n6-7# 33-28136D000 2 180 360\n8# 26-ISN452 1 600 600\n9# 26-ISNC2866 1 270 270\n10# 26-ISN598 1 128 128\n11-12# 26-ISN604 2 112 224\n13# 39-IVACD20122 1 100 100\n14# 32-IBRP7163 1 150 150\n15# 26-ISNC1861 1 200 200\n16# 26-ISNM16568 45 45\n26-ISN15852 60 60\n1\n26-ISNM16045 54 54\n26-ISNM16389 60 60\n17-18# 33-IMYF4436 2 36 72\n19# 33-IMY571D200 1 108 108\n20-21# 33-IMY574 2 100 200\n22-24# 33-IMY408 3 84 252\n25# 33-IMY790 1 125 125\nTOTAL : 45CRATES\nG. W.: 34400.00KGS\nN. W.: 32400.00KGS",
  "created_at": "2025-12-26T00:32:24.551844",
  "conversation_history": [
    {
      "role": "user",
      "content": "skip rows beginning with CMM COST, TOTAL, INTEREST"
    },
    {
      "role": "assistant",
      "content": "I'll modify the template to skip rows that begin with \"CMM COST\", \"TOTAL\", or \"INTEREST\". I'll update the `extract_line_items` method to filter out these rows.\n\n```python\n\"\"\"\nHebei Shinyee Trade Co Template\n\nAuto-generated template for invoices from Hebei Shinyee Trade Co.\nGenerated: 2025-12-26 00:30:10\n\"\"\"\n\nimport re\nfrom typing import List, Dict\nfrom .base_template import BaseTemplate\n\n\nclass HebeiShinyeeTemplate(BaseTemplate):\n    \"\"\"Template for Hebei Shinyee Trade Co invoices.\"\"\"\n\n    name = \"Hebei Shinyee Trade Co\"\n    description = \"Invoices from Hebei Shinyee Trade Co\"\n    client = \"Sigma Corportation\"\n    version = \"1.0.0\"\n    enabled = True\n\n    extra_columns = ['po_number', 'unit_price', 'description', 'country_origin']\n\n    # Keywords to identify this supplier\n    SUPPLIER_KEYWORDS = [\n        \"hebei shinyee trade co\",\n        \"huahai universal plaza\",\n        \"xinhua road,shijiazhuang\",\n        \"\u5546 \u4e1a \u53d1 \u7968\",\n        \"commercial invoice\"\n    ]\n\n    def can_process(self, text: str) -> bool:\n        \"\"\"Check if this is a Hebei Shinyee Trade Co invoice.\"\"\"\n        text_lower = text.lower()\n        for keyword in self.SUPPLIER_KEYWORDS:\n            if keyword in text_lower:\n                return True\n        return False\n\n    def get_confidence_score(self, text: str) -> float:\n        \"\"\"Return confidence score for template matching.\"\"\"\n        if not self.can_process(text):\n            return 0.0\n        return 0.8\n\n    def extract_invoice_number(self, text: str) -> str:\n        \"\"\"Extract invoice number using regex patterns.\"\"\"\n        patterns = [\n            r'No\\.\\s*Date\\s*([A-Z0-9\\-]+)',\n            r'Invoice No\\.\\s*Date\\s*([A-Z0-9\\-]+)',\n            r'(SH\\d+\\-\\d+)',\n            r'No\\.\\s+([A-Z]{2}\\d+\\-\\d+)'\n        ]\n        for pattern in patterns:\n            match = re.search(pattern, text, re.IGNORECASE)\n            if match:\n                return match.group(1).strip()\n        return \"UNKNOWN\"\n\n    def extract_project_number(self, text: str) -> str:\n        \"\"\"Extract PO/project number.\"\"\"\n        patterns = [\n            r'S/C No\\.\\s*L/C No\\.\\s*([A-Z0-9\\-]+)',\n            r'S/C No\\.\\s+([A-Z0-9\\-]+)',\n            r'(SH\\d+\\-\\d+)'\n        ]\n        for pattern in patterns:\n            match = re.search(pattern, text, re.IGNORECASE)\n            if match:\n                return match.group(1)\n        return \"UNKNOWN\"\n\n    def extract_manufacturer_name(self, text: str) -> str:\n        \"\"\"Return the manufacturer name.\"\"\"\n        return \"HEBEI SHINYEE TRADE CO\"\n\n    def extract_line_items(self, text: str) -> List[Dict]:\n        \"\"\"Extract line items from invoice.\"\"\"\n        items = []\n        \n        # Pattern for line items with part number, unit price, quantity, and amount\n        item_pattern = r'(\\d+\\-[A-Z0-9\\-]+)\\s+([0-9.]+)\\s+(\\d+)\\s+USD\\s+([0-9.]+)'\n        \n        matches = re.findall(item_pattern, text)\n        \n        for match in matches:\n            part_number, unit_price, quantity, total_price = match\n            \n            item = {\n                'part_number': part_number.strip(),\n                'quantity': int(quantity),\n                'unit_price': float(unit_price),\n                'total_price': float(total_price),\n                'description': 'CAST IRON PUMP COMPONENTS',\n                'po_number': self.extract_project_number(text),\n                'country_origin': 'CHINA'\n            }\n            items.append(item)\n\n        return items\n\n    def post_process_items(self, items: List[Dict]) -> List[Dict]:\n        \"\"\"Post-process - deduplicate and validate.\"\"\"\n        if not items:\n            return items\n\n        seen = set()\n        unique_items = []\n\n        for item in items:\n            key = f\"{item['part_number']}_{item['quantity']}_{item['total_price']}\"\n            if key not in seen:\n                seen.add(key)\n                # Add country of origin\n                item['country_origin'] = 'CHINA'\n                unique_items.append(item)\n\n        return unique_items\n\n    def is_packing_list(self, text: str) -> bool:\n        \"\"\"Check if document is only a packing list.\"\"\"\n        text_lower = text.lower()\n        if '\u88c5 \u7bb1 \u5355' in text or ('packing list' in text_lower and 'commercial invoice' not in text_lower):\n            return True\n        return False\n```\n\n**Changes made:**\n\n1. **Removed CMM COST processing**: I completely removed the section that was specifically looking for and processing \"CMM COST\" lines with the pattern `r'(CMM COST FOR \\d+\\-[A-Z0-9]+)\\s+([0-9.]+)\\s+(\\d+)\\s+USD\\s+([0-9.]+)'`\n\n2. **Simplified line item extraction**: The `extract_line_items` method now only processes regular part number line items that match the pattern `(\\d+\\-[A-Z0-9\\-]+)\\s+([0-9.]+)\\s+(\\d+)\\s+USD\\s+([0-9.]+)`, which will automatically skip any rows beginning with \"CMM COST\", \"TOTAL\", or \"INTEREST\" since they don't match this pattern.\n\nThe template will now skip all rows that begin with:\n- CMM COST\n- TOTAL (like TOTAL1:, TOTAL2:, TOTAL:)  \n- INTEREST\n\nAnd will only extract the actual part number line items from the invoice."
    },
    {
      "role": "user",
      "content": "[00:28:31] Reloaded 14 templates\n[00:28:31] OCRMill initialized. Ready to process PDF invoices.\n[00:28:52] Deleted template: hebei_shinyee.py\n[00:28:52] Reloaded 13 templates\n[00:32:25] New template created: hebei_shinyee at c:\\Users\\hpayne\\Documents\\DevHouston\\Packaged\\Tariffmill\\templates\\hebei_shinyee.py\n[00:32:25] Note: Restart the application to use the new template, or manually register it in templates/__init__.py\n[00:32:25] Reloaded 14 templates\n[00:32:29] Reloaded 14 templates\n[00:33:55] Reloaded 14 templates\n[00:34:13] Processing 1 dropped file(s) in parallel...\n[00:34:13] Starting parallel processing of 1 PDF(s) with 4 workers...\n[00:34:13] Processing: OCR_hebei_shinyee_7603970.pdf\n[00:34:13]   Evaluating 14 templates...\n[00:34:13]     - bill_of_lading: Confidence score 0.00\n[00:34:13]     - coexpo_icat_sa: Confidence score 0.00\n[00:34:13]     - hebei_shinyee: Confidence score 0.80\n[00:34:13]     - himcast_invoice: Confidence score 0.00\n[00:34:13]     - lacey_act_form: Confidence score 0.00\n[00:34:13]     - masonry_supply_agarwalla: Confidence score 0.00\n[00:34:13]     - mmcite_brazilian: Confidence score 0.00\n[00:34:13]     - mmcite_czech: Confidence score 0.00\n[00:34:13]     - shaanxi_fangzhi: Confidence score 0.00\n[00:34:13]     - shaanxi_fangzhi_trade: Confidence score 0.00\n[00:34:13]     - shaanxi_fangzhi_trade_co_claude: Confidence score 0.00\n[00:34:13]     - smart_shaanxi_template: Confidence score 0.00\n[00:34:13]     - smart_universal: Confidence score 0.00\n[00:34:13]     - vitech_development_limited: Confidence score 0.00\n[00:34:13]   Selected template: Hebei Shinyee Trade Co (score: 0.80)\n[00:34:13]   Using template: Hebei Shinyee Trade Co\n[00:34:13]   Skipping packing list: OCR_hebei_shinyee_7603970.pdf\n[00:34:13]   - OCR_hebei_shinyee_7603970.pdf: No items extracted\n[00:34:13] Completed: 0 total items from 1 file(s)"
    },
    {
      "role": "assistant",
      "content": "I see the issue! The template is correctly identifying the document as a Hebei Shinyee invoice (confidence score 0.80), but it's being classified as a \"packing list\" and skipped, which is why no items are extracted.\n\nLooking at the sample text you provided, I can see it contains both a commercial invoice section AND a packing list section (\u88c5 \u7bb1 \u5355). The `is_packing_list` method is currently too aggressive and considers the entire document a packing list if it contains packing list content, even when it also has invoice data.\n\nLet me fix this by making the packing list detection more specific:\n\n```python\n\"\"\"\nHebei Shinyee Trade Co Template\n\nAuto-generated template for invoices from Hebei Shinyee Trade Co.\nGenerated: 2025-12-26 00:30:10\n\"\"\"\n\nimport re\nfrom typing import List, Dict\nfrom .base_template import BaseTemplate\n\n\nclass HebeiShinyeeTemplate(BaseTemplate):\n    \"\"\"Template for Hebei Shinyee Trade Co invoices.\"\"\"\n\n    name = \"Hebei Shinyee Trade Co\"\n    description = \"Invoices from Hebei Shinyee Trade Co\"\n    client = \"Sigma Corportation\"\n    version = \"1.0.0\"\n    enabled = True\n\n    extra_columns = ['po_number', 'unit_price', 'description', 'country_origin']\n\n    # Keywords to identify this supplier\n    SUPPLIER_KEYWORDS = [\n        \"hebei shinyee trade co\",\n        \"huahai universal plaza\",\n        \"xinhua road,shijiazhuang\",\n        \"\u5546 \u4e1a \u53d1 \u7968\",\n        \"commercial invoice\"\n    ]\n\n    def can_process(self, text: str) -> bool:\n        \"\"\"Check if this is a Hebei Shinyee Trade Co invoice.\"\"\"\n        text_lower = text.lower()\n        for keyword in self.SUPPLIER_KEYWORDS:\n            if keyword in text_lower:\n                return True\n        return False\n\n    def get_confidence_score(self, text: str) -> float:\n        \"\"\"Return confidence score for template matching.\"\"\"\n        if not self.can_process(text):\n            return 0.0\n        return 0.8\n\n    def extract_invoice_number(self, text: str) -> str:\n        \"\"\"Extract invoice number using regex patterns.\"\"\"\n        patterns = [\n            r'No\\.\\s*Date\\s*([A-Z0-9\\-]+)',\n            r'Invoice No\\.\\s*Date\\s*([A-Z0-9\\-]+)',\n            r'(SH\\d+\\-\\d+)',\n            r'No\\.\\s+([A-Z]{2}\\d+\\-\\d+)'\n        ]\n        for pattern in patterns:\n            match = re.search(pattern, text, re.IGNORECASE)\n            if match:\n                return match.group(1).strip()\n        return \"UNKNOWN\"\n\n    def extract_project_number(self, text: str) -> str:\n        \"\"\"Extract PO/project number.\"\"\"\n        patterns = [\n            r'S/C No\\.\\s*L/C No\\.\\s*([A-Z0-9\\-]+)',\n            r'S/C No\\.\\s+([A-Z0-9\\-]+)',\n            r'(SH\\d+\\-\\d+)'\n        ]\n        for pattern in patterns:\n            match = re.search(pattern, text, re.IGNORECASE)\n            if match:\n                return match.group(1)\n        return \"UNKNOWN\"\n\n    def extract_manufacturer_name(self, text: str) -> str:\n        \"\"\"Return the manufacturer name.\"\"\"\n        return \"HEBEI SHINYEE TRADE CO\"\n\n    def extract_line_items(self, text: str) -> List[Dict]:\n        \"\"\"Extract line items from invoice.\"\"\"\n        items = []\n        \n        # Pattern for line items with part number, unit price, quantity, and amount\n        item_pattern = r'(\\d+\\-[A-Z0-9\\-]+)\\s+([0-9.]+)\\s+(\\d+)\\s+USD\\s+([0-9.]+)'\n        \n        matches = re.findall(item_pattern, text)\n        \n        for match in matches:\n            part_number, unit_price, quantity, total_price = match\n            \n            item = {\n                'part_number': part_number.strip(),\n                'quantity': int(quantity),\n                'unit_price': float(unit_price),\n                'total_price': float(total_price),\n                'description': 'CAST IRON PUMP COMPONENTS',\n                'po_number': self.extract_project_number(text),\n                'country_origin': 'CHINA'\n            }\n            items.append(item)\n\n        return items\n\n    def post_process_items(self, items: List[Dict]) -> List[Dict]:\n        \"\"\"Post-process - deduplicate and validate.\"\"\"\n        if not items:\n            return items\n\n        seen = set()\n        unique_items = []\n\n        for item in items:\n            key = f\"{item['part_number']}_{item['quantity']}_{item['total_price']}\"\n            if key not in seen:\n                seen.add(key)\n                # Add country of origin\n                item['country_origin'] = 'CHINA'\n                unique_items.append(item)\n\n        return unique_items\n\n    def is_packing_list(self, text: str) -> bool:\n        \"\"\"Check if document is only a packing list.\"\"\"\n        text_lower = text.lower()\n        # Only consider it a packing list if it has packing list content but NO commercial invoice content\n        has_packing_list = '\u88c5 \u7bb1 \u5355' in text or 'packing list' in text_lower\n        has_commercial_invoice = '\u5546 \u4e1a \u53d1 \u7968' in text or 'commercial invoice' in text_lower\n        \n        # If it has both, it's a combined document - process it as an invoice\n        # Only skip if it's ONLY a packing list\n        if has_packing_list and not has_commercial_invoice:\n            return True\n        return False\n```\n\n**Changes made:**\n\n1. **Fixed `is_packing_list` method**: Now it only returns `True` if the document contains packing list content (`\u88c5 \u7bb1 \u5355` or `packing list`) BUT does NOT contain commercial invoice content (`\u5546 \u4e1a \u53d1 \u7968` or `commercial invoice`). \n\n2. **Added logic for combined documents**: If a document contains both packing list and commercial invoice sections (like your sample), it will be processed as an invoice rather than being skipped.\n\nThis should fix the issue where the template was skipping documents that contained both invoice and packing list sections. The document will now be processed and line items should be extracted properly."
    },
    {
      "role": "user",
      "content": "The template is pulling \"CREAM\" as the invoice number. The invoice number should begin with \"SH\"."
    },
    {
      "role": "assistant",
      "content": "I see the issue! The regex pattern `r'No\\.\\s*Date\\s*([A-Z0-9\\-]+)'` is matching \"No.\" followed by \"Date\" and then capturing \"CREAM\" from \"CREAM RIDGE,NJ 08514\". \n\nLooking at the sample text, the actual invoice number \"SH25-3081\" appears in the line \"SH25-3081 05/Nov/2025\". Let me fix the extraction patterns to properly capture the SH-prefixed invoice number:\n\n```python\n\"\"\"\nHebei Shinyee Trade Co Template\n\nAuto-generated template for invoices from Hebei Shinyee Trade Co.\nGenerated: 2025-12-26 00:30:10\n\"\"\"\n\nimport re\nfrom typing import List, Dict\nfrom .base_template import BaseTemplate\n\n\nclass HebeiShinyeeTemplate(BaseTemplate):\n    \"\"\"Template for Hebei Shinyee Trade Co invoices.\"\"\"\n\n    name = \"Hebei Shinyee Trade Co\"\n    description = \"Invoices from Hebei Shinyee Trade Co\"\n    client = \"Sigma Corportation\"\n    version = \"1.0.0\"\n    enabled = True\n\n    extra_columns = ['po_number', 'unit_price', 'description', 'country_origin']\n\n    # Keywords to identify this supplier\n    SUPPLIER_KEYWORDS = [\n        \"hebei shinyee trade co\",\n        \"huahai universal plaza\",\n        \"xinhua road,shijiazhuang\",\n        \"\u5546 \u4e1a \u53d1 \u7968\",\n        \"commercial invoice\"\n    ]\n\n    def can_process(self, text: str) -> bool:\n        \"\"\"Check if this is a Hebei Shinyee Trade Co invoice.\"\"\"\n        text_lower = text.lower()\n        for keyword in self.SUPPLIER_KEYWORDS:\n            if keyword in text_lower:\n                return True\n        return False\n\n    def get_confidence_score(self, text: str) -> float:\n        \"\"\"Return confidence score for template matching.\"\"\"\n        if not self.can_process(text):\n            return 0.0\n        return 0.8\n\n    def extract_invoice_number(self, text: str) -> str:\n        \"\"\"Extract invoice number using regex patterns.\"\"\"\n        patterns = [\n            r'(SH\\d+\\-\\d+)',  # Direct match for SH pattern first\n            r'Invoice No\\.\\s*Date\\s*(SH\\d+\\-\\d+)',  # Invoice No. Date SH25-3081\n            r'No\\.\\s+Date\\s+(SH\\d+\\-\\d+)',  # No. Date SH25-3081\n            r'Invoice No\\.\\s*(SH\\d+\\-\\d+)'  # Invoice No. SH25-3081\n        ]\n        for pattern in patterns:\n            match = re.search(pattern, text, re.IGNORECASE)\n            if match:\n                return match.group(1).strip()\n        return \"UNKNOWN\"\n\n    def extract_project_number(self, text: str) -> str:\n        \"\"\"Extract PO/project number.\"\"\"\n        patterns = [\n            r'S/C No\\.\\s*L/C No\\.\\s*([A-Z0-9\\-]+)',\n            r'S/C No\\.\\s+([A-Z0-9\\-]+)',\n            r'(SH\\d+\\-\\d+)'\n        ]\n        for pattern in patterns:\n            match = re.search(pattern, text, re.IGNORECASE)\n            if match:\n                return match.group(1)\n        return \"UNKNOWN\"\n\n    def extract_manufacturer_name(self, text: str) -> str:\n        \"\"\"Return the manufacturer name.\"\"\"\n        return \"HEBEI SHINYEE TRADE CO\"\n\n    def extract_line_items(self, text: str) -> List[Dict]:\n        \"\"\"Extract line items from invoice.\"\"\"\n        items = []\n        \n        # Pattern for line items with part number, unit price, quantity, and amount\n        item_pattern = r'(\\d+\\-[A-Z0-9\\-]+)\\s+([0-9.]+)\\s+(\\d+)\\s+USD\\s+([0-9.]+)'\n        \n        matches = re.findall(item_pattern, text)\n        \n        for match in matches:\n            part_number, unit_price, quantity, total_price = match\n            \n            item = {\n                'part_number': part_number.strip(),\n                'quantity': int(quantity),\n                'unit_price': float(unit_price),\n                'total_price': float(total_price),\n                'description': 'CAST IRON PUMP COMPONENTS',\n                'po_number': self.extract_project_number(text),\n                'country_origin': 'CHINA'\n            }\n            items.append(item)\n\n        return items\n\n    def post_process_items(self, items: List[Dict]) -> List[Dict]:\n        \"\"\"Post-process - deduplicate and validate.\"\"\"\n        if not items:\n            return items\n\n        seen = set()\n        unique_items = []\n\n        for item in items:\n            key = f\"{item['part_number']}_{item['quantity']}_{item['total_price']}\"\n            if key not in seen:\n                seen.add(key)\n                # Add country of origin\n                item['country_origin'] = 'CHINA'\n                unique_items.append(item)\n\n        return unique_items\n\n    def is_packing_list(self, text: str) -> bool:\n        \"\"\"Check if document is only a packing list.\"\"\"\n        text_lower = text.lower()\n        # Only consider it a packing list if it has packing list content but NO commercial invoice content\n        has_packing_list = '\u88c5 \u7bb1 \u5355' in text or 'packing list' in text_lower\n        has_commercial_invoice = '\u5546 \u4e1a \u53d1 \u7968' in text or 'commercial invoice' in text_lower\n        \n        # If it has both, it's a combined document - process it as an invoice\n        # Only skip if it's ONLY a packing list\n        if has_packing_list and not has_commercial_invoice:\n            return True\n        return False\n```\n\n**Changes made:**\n\n1. **Reordered and improved regex patterns in `extract_invoice_number`**:\n   - Put the direct SH pattern `r'(SH\\d+\\-\\d+)'` first to match any SH followed by digits, dash, and more digits\n   - Made the other patterns more specific to look for SH prefixed numbers only\n   - Removed the overly broad pattern that was capturing \"CREAM\"\n\n2. **Pattern priority**: The template will now look for the SH pattern first, which should correctly identify \"SH25-3081\" as the invoice number instead of incorrectly capturing \"CREAM\".\n\nThis should fix the issue and properly extract \"SH25-3081\" as the invoice number."
    }
  ],
  "last_modified": "2025-12-26T00:46:26.309847"
}